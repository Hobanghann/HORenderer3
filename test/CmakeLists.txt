message("\n######## Start to process test ########\n")

set_property(GLOBAL PROPERTY USE_FOLDERS ON)
##########################################################
# Download and Make Available Google Test
##########################################################
set(GTEST_NAME googletest)

FetchContent_Declare(${GTEST_NAME}
  GIT_REPOSITORY https://github.com/google/googletest.git
  GIT_TAG v1.14.0
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

message ("#### Start to Download " ${GTEST_NAME} "... ####")
FetchContent_MakeAvailable(${GTEST_NAME})
message ("#### Downloading " ${GTEST_NAME} " finished. ####")

################################################################################
# Set Google Test properties
################################################################################
foreach(tgt gmock gmock_main gtest gtest_main)
    if (TARGET ${tgt})
        set_target_properties(${tgt} PROPERTIES FOLDER "Test/gtest")
        target_include_directories(${tgt} SYSTEM INTERFACE 
            "${googletest_SOURCE_DIR}/googletest/include"
            "${googletest_SOURCE_DIR}/googlemock/include"
        )
    endif()
endforeach()

################################################################################
# Process subdirectories
################################################################################
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/core)
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/resource)
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/virtual_gpu)

message("\n######## Processing test finished. ########\n")
